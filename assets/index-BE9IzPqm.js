var p=(a,l,c)=>new Promise((r,x)=>{var _=t=>{try{i(c.next(t))}catch(n){x(n)}},d=t=>{try{i(c.throw(t))}catch(n){x(n)}},i=t=>t.done?r(t.value):Promise.resolve(t.value).then(_,d);i((c=c.apply(a,l)).next())});import{j as s}from"./vendor-animation-BdtpEFhq.js";import{r as o,i as v,j as N,L as y,X as L}from"./vendor-icons-BLMAXFSW.js";import{e as C,i as I,l as B,f as S}from"./services-DKJcYfkm.js";function k(){const[a,l]=o.useState(!0),[c,r]=o.useState(null),[x,_]=o.useState(!1),d=o.useCallback(()=>{const n=C();r(n),_(I())},[]);o.useEffect(()=>{d(),l(!1)},[d]);const i=o.useCallback((n,h)=>p(null,null,function*(){l(!0);const g=yield B({username:n,password:h});return g?(r(g),_(!0),l(!1),!0):(l(!1),!1)}),[]),t=o.useCallback(()=>p(null,null,function*(){l(!0),yield S(),r(null),_(!1),l(!1)}),[]);return{isAuthenticated:x,user:c,isLoading:a,login:i,logout:t,refreshUser:d}}const w="_loginContainer_osie1_1",P="_userInfo_osie1_7",z="_username_osie1_16",A="_loginForm_osie1_22",G="_error_osie1_29",M="_input_osie1_42",U="_btnLogin_osie1_72",E="_btnLogout_osie1_104",T="_loading_osie1_124",$="_fullMode_osie1_134",D="_loginFormFull_osie1_138",O="_inputGroup_osie1_145",R="_label_osie1_151",X="_inputFull_osie1_157",q="_errorBoxFull_osie1_180",H="_btnLoginFull_osie1_189",J="_userProfile_osie1_221",K="_userInfoFull_osie1_231",Q="_usernameFull_osie1_237",V="_btnLogoutFull_osie1_259",e={loginContainer:w,userInfo:P,username:z,loginForm:A,error:G,input:M,btnLogin:U,btnLogout:E,loading:T,fullMode:$,loginFormFull:D,inputGroup:O,label:R,inputFull:X,errorBoxFull:q,btnLoginFull:H,userProfile:J,userInfoFull:K,usernameFull:Q,btnLogoutFull:V};function W({mode:a="compact",onLoginSuccess:l}={}){const{isAuthenticated:c,user:r,isLoading:x,login:_,logout:d}=k(),[i,t]=o.useState(""),[n,h]=o.useState(""),[g,b]=o.useState(null),[m,j]=o.useState(!1),F=u=>p(null,null,function*(){if(u.preventDefault(),b(null),!i.trim()||!n.trim()){b("请输入用户名和密码");return}if(j(!0),!(yield _(i,n))){b("登录失败：用户名或密码错误"),j(!1);return}t(""),h(""),j(!1),l==null||l()});return x?s.jsx("div",{className:e.loginContainer,children:s.jsx("button",{className:e.loading,disabled:!0,children:"加载中..."})}):c&&r?a==="full"?s.jsx("div",{className:e.fullMode,children:s.jsxs("div",{className:e.userProfile,children:[s.jsx("div",{className:e.userInfoFull,children:s.jsxs("div",{className:e.usernameFull,children:[s.jsx(v,{size:18}),"已登录：",r.username]})}),s.jsxs("button",{onClick:d,className:e.btnLogoutFull,children:[s.jsx(N,{size:18}),"退出登录"]})]})}):s.jsxs("div",{className:e.loginContainer,children:[s.jsx("div",{className:e.userInfo,children:s.jsxs("span",{className:e.username,children:["欢迎，",r.username]})}),s.jsx("button",{onClick:d,className:e.btnLogout,children:"登出"})]}):a==="full"?s.jsx("div",{className:e.fullMode,children:s.jsxs("form",{onSubmit:F,className:e.loginFormFull,children:[g&&s.jsx("div",{className:e.errorBoxFull,children:g}),s.jsxs("div",{className:e.inputGroup,children:[s.jsx("label",{className:e.label,children:"用户名"}),s.jsx("input",{type:"text",placeholder:"请输入用户名",value:i,onChange:u=>t(u.target.value),disabled:m,className:e.inputFull,autoFocus:!0})]}),s.jsxs("div",{className:e.inputGroup,children:[s.jsx("label",{className:e.label,children:"密码"}),s.jsx("input",{type:"password",placeholder:"请输入密码",value:n,onChange:u=>h(u.target.value),disabled:m,className:e.inputFull})]}),s.jsx("button",{type:"submit",disabled:m,className:e.btnLoginFull,children:m?s.jsxs(s.Fragment,{children:[s.jsx(y,{className:"animate-spin",size:18}),"登录中..."]}):s.jsxs(s.Fragment,{children:[s.jsx(v,{size:18}),"登录"]})})]})}):s.jsx("div",{className:e.loginContainer,children:s.jsxs("form",{onSubmit:F,className:e.loginForm,children:[g&&s.jsx("span",{className:e.error,children:g}),s.jsx("input",{type:"text",placeholder:"用户名",value:i,onChange:u=>t(u.target.value),disabled:m,className:e.input}),s.jsx("input",{type:"password",placeholder:"密码",value:n,onChange:u=>h(u.target.value),disabled:m,className:e.input}),s.jsx("button",{type:"submit",disabled:m,className:e.btnLogin,children:m?"登录中...":"登录"})]})})}const Y="_overlay_1tvy1_1",Z="_modal_1tvy1_13",ss="_closeBtn_1tvy1_39",es="_title_1tvy1_48",ls="_form_1tvy1_66",ts="_section_1tvy1_71",ns="_sectionTitle_1tvy1_76",f={overlay:Y,modal:Z,closeBtn:ss,title:es,form:ls,section:ts,sectionTitle:ns},cs=({onClose:a})=>s.jsx("div",{className:f.overlay,onClick:a,children:s.jsxs("div",{className:f.modal,onClick:l=>l.stopPropagation(),children:[s.jsx("button",{onClick:a,className:f.closeBtn,children:s.jsx(L,{size:24})}),s.jsx("h2",{className:f.title,children:"设置"}),s.jsx("div",{className:f.form,children:s.jsxs("div",{className:f.section,children:[s.jsx("h3",{className:f.sectionTitle,children:"账号管理"}),s.jsx(W,{mode:"full"})]})})]})});export{cs as Settings};
