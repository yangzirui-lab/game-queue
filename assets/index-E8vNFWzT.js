var D=Object.defineProperty,G=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var I=(n,i,a)=>i in n?D(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,P=(n,i)=>{for(var a in i||(i={}))A.call(i,a)&&I(n,a,i[a]);if(f)for(var a of f(i))F.call(i,a)&&I(n,a,i[a]);return n},R=(n,i)=>G(n,T(i));var p=(n,i,a)=>new Promise((x,d)=>{var g=o=>{try{l(a.next(o))}catch(m){d(m)}},u=o=>{try{l(a.throw(o))}catch(m){d(m)}},l=o=>o.done?x(o.value):Promise.resolve(o.value).then(g,u);l((a=a.apply(n,i)).next())});import{j as s}from"./vendor-animation-BdtpEFhq.js";import{r as y,X as z,L as S,h as M}from"./vendor-icons-BLMAXFSW.js";import{c as E}from"./index-Dvr8yYNv.js";import{s as j}from"./services-DKJcYfkm.js";import"./vendor-react-CPL0-ziD.js";import"./vendor-utils-B4HTqFrb.js";const b="_overlay_13yiy_1",k="_modal_13yiy_13",K="_closeBtn_13yiy_40",$="_title_13yiy_49",q="_searchWrapper_13yiy_65",Q="_inputWrapper_13yiy_68",U="_inputPrimary_13yiy_71",X="_loadingIcon_13yiy_85",H="_searchStatus_13yiy_94",J="_errorBox_13yiy_99",O="_resultsList_13yiy_106",V="_resultItem_13yiy_124",Y="_coverImage_13yiy_133",Z="_gameInfo_13yiy_139",ee="_gameName_13yiy_142",se="_gameMeta_13yiy_147",te="_metaRating_13yiy_193",ae="_ratingPercentage_13yiy_198",ie="_high_13yiy_202",ne="_medium_13yiy_205",re="_low_13yiy_208",oe="_reviewCount_13yiy_211",ce="_metaRatingLoading_13yiy_216",le="_metaTags_13yiy_222",de="_addBtn_13yiy_225",me="_loading_13yiy_85",t={overlay:b,modal:k,closeBtn:K,title:$,searchWrapper:q,inputWrapper:Q,inputPrimary:U,loadingIcon:X,searchStatus:H,errorBox:J,resultsList:O,resultItem:V,coverImage:Y,gameInfo:Z,gameName:ee,gameMeta:se,metaRating:te,ratingPercentage:ae,high:ie,medium:ne,low:re,reviewCount:oe,metaRatingLoading:ce,metaTags:le,addBtn:de,loading:me},xe=({onAddGame:n,onClose:i})=>{const[a,x]=y.useState(""),[d,g]=y.useState([]),[u,l]=y.useState(!1),[o,m]=y.useState(null),[h,N]=y.useState(null),B=e=>p(null,null,function*(){const[r,c]=yield Promise.all([j.getGameReviews({appId:e.id}),j.getGameReleaseDate({appId:e.id})]);if(!r||!c){console.warn(`Failed to fetch info for game ${e.id}`);return}g(v=>v.map(_=>_.id===e.id?R(P({},_),{positivePercentage:r.positivePercentage,totalReviews:r.totalReviews,releaseDate:c.releaseDate,comingSoon:c.comingSoon,isEarlyAccess:c.isEarlyAccess}):_))});y.useEffect(()=>{if(!a.trim()){g([]);return}l(!0),m(null);const e=setTimeout(()=>p(null,null,function*(){const r=yield j.search({query:a});if(r===null){m("搜索失败，请重试"),l(!1);return}g(r),r.forEach(c=>{B(c)}),l(!1)}),500);return()=>{clearTimeout(e),l(!1)}},[a]);const C=e=>{e.key==="Escape"&&i()},L=e=>p(null,null,function*(){var r,c,v,_,w;if(h===null){N(e.id);try{yield n(e.name,e.steamUrl,e.coverImage,e.tags,(r=e.positivePercentage)!=null?r:void 0,(c=e.totalReviews)!=null?c:void 0,(v=e.releaseDate)!=null?v:void 0,(_=e.comingSoon)!=null?_:void 0,(w=e.isEarlyAccess)!=null?w:void 0),i()}catch(W){console.error("Failed to add game:",W),m("添加游戏失败，请重试")}finally{N(null)}}});return s.jsx("div",{className:t.overlay,children:s.jsxs("div",{className:t.modal,children:[s.jsx("button",{onClick:i,className:t.closeBtn,children:s.jsx(z,{size:24})}),s.jsx("h2",{className:t.title,children:"从 Steam 搜索游戏"}),s.jsxs("div",{className:t.searchWrapper,children:[s.jsxs("div",{className:t.inputWrapper,children:[s.jsx("input",{type:"text",className:t.inputPrimary,placeholder:"输入游戏名称开始搜索...",value:a,onChange:e=>x(e.target.value),onKeyDown:C,autoFocus:!0}),u&&s.jsx("div",{className:t.loadingIcon,children:s.jsx(S,{size:18,className:"animate-spin"})})]}),a&&s.jsx("div",{className:t.searchStatus,children:u?"正在搜索...":d.length>0?`找到 ${d.length} 个结果`:"没有找到结果"})]}),o&&s.jsx("div",{className:t.errorBox,children:o}),s.jsx("div",{className:t.resultsList,children:d.length>0&&d.map(e=>s.jsxs("div",{className:t.resultItem,children:[s.jsx("img",{src:e.coverImage,alt:e.name,className:t.coverImage,onError:r=>{r.target.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="120" height="45"%3E%3Crect fill="%23333" width="120" height="45"/%3E%3Ctext x="50%25" y="50%25" fill="%23666" text-anchor="middle" dy=".3em"%3ENo Image%3C/text%3E%3C/svg%3E'}}),s.jsxs("div",{className:t.gameInfo,children:[s.jsx("div",{className:t.gameName,children:e.name}),s.jsxs("div",{className:t.gameMeta,children:[e.positivePercentage!==null&&e.totalReviews!==null&&e.totalReviews>0?s.jsxs("div",{className:t.metaRating,children:[s.jsxs("span",{className:E(t.ratingPercentage,{[t.high]:e.positivePercentage>=80,[t.medium]:e.positivePercentage>=60&&e.positivePercentage<80,[t.low]:e.positivePercentage<60}),children:[e.positivePercentage,"% 好评"]}),s.jsxs("span",{className:t.reviewCount,children:[e.totalReviews.toLocaleString()," 条评论"]})]}):s.jsx("div",{className:t.metaRatingLoading,children:"加载好评率中..."}),e.tags.length>0&&s.jsx("div",{className:t.metaTags,children:e.tags.join(", ")})]})]}),s.jsx("button",{onClick:()=>L(e),className:E(t.addBtn,{[t.loading]:h===e.id}),disabled:h===e.id,children:h===e.id?s.jsxs(s.Fragment,{children:[s.jsx(S,{size:16,className:"animate-spin"}),"添加中..."]}):s.jsxs(s.Fragment,{children:[s.jsx(M,{size:16}),"添加"]})})]},e.id))})]})})};export{xe as SteamSearch};
